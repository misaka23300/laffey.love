# 使用keil5创建项目 

我们需要的软件有：

- keil5
- stc-isp

我们还需要51单片机。

1.创建项目，点击`project`，选择`New uVision Project`来创建项目。

![image-20250923143632131](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250923143632131.png)

2.选择一个目录存放后，会弹出选择设备的界面。

![image-20250923143728211](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250923143728211.png)

3.我们需要把STC的单片机添加到keil5中。

![添加单片机型号-1](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/QQ_1761811516886.png)

如果没有`STC MCU Database`, 那么打开“STC-ISP”软件，在右侧选择`keil仿真设置`，点击添加型号和头文件到keil中。

![image-20250923144106630](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250923144106630.png)

![image-20250923144141749](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250923144141749.png)

点击确定，即可弹出`MCU型号添加成功`的窗口。

4.添加完成之后，我们重新打开keil5软件，新建工程，来选择`ISP14F2K60S2`这个单片机，我们可以搜索单片机型号。

![image-20250923144442080](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250923144442080.png)

接下来会弹出这个窗口，点击`是`.

![image-20250923144517394](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250923144517394.png)

就此项目创建完成。

## 项目结构

我们做的一个项目，需要有一个项目结构来管理我们的代码。我们可以通过结构把代码分为不同的功能，让编译器更好的编译。比如把头文件放在一个文件夹，main.c放在一个文件夹，其他传感器放在一个文件夹。

参考乐鑫科技的[文档](https://docs.espressif.com/projects/esp-idf/zh_CN/stable/esp32/contribute/creating-examples.html)，一个项目需要以下结构：

- main文件夹
- include文件夹
- readme.md

main文件夹包含`.c`文件，include文件夹包含`.h`头文件，readme.md是对项目的说明，可以使用[模版](https://github.com/espressif/esp-idf/blob/v5.5.1/docs/TEMPLATE_EXAMPLE_README.md)。

![image-20250923151131804](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250923151131804.png)

我们可以创建一个`group`，命名为`main`，并将`main.c`等c文件添加到`files`这个栏。

c语言的多个文件编译，需要编写cmake，在keil5中，你可以使用图形界面添加需要编译的文件，不用编写cmake。

由于我们把.c文件和.h文件分开，编译器无法直接找到对应的头文件。我们需要把头文件的路径添加到include中，让编译器找到头文件。点开`魔法棒`图标，选择C51，在`include paths`添加`include`目录。

![image-20250923154904858](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250923154904858.png)

这样，我们就可以基于此项目结构编写代码并编译了。

我们在`main.c`里写入

```c
#include "main.h"

int main()
{
	return 0;
}
```

让我们点击编译图标编译一下代码吧。

<img src="./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250923160511747.png" alt="image-20250923160511747" style="zoom: 67%;" />

0Error 0Warning  恭喜你成功编译了第一个项目的代码。

## 烧录 STC-ISP

我们使用的是STC的芯片，所以要用到他们的`STC-ISP`进行烧录。我们在官网可以下载这个软件。

我们来看看这个软件的界面：

![QQ_1759111927184](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/QQ_1759111927184.png)

先来说一下烧录的步骤吧。

### 1. 选择要烧录型号的单片机。

   ![image-20250929101301244](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/image-20250929101301244.png)

如果选择有点繁琐，可以将单片机通过USB线连接到电脑上，选择对应的串口号，点击`检测MCU`选项，即可自动选择MCU型号。

### 2. 选择对应的串口号

   右键点击任务栏的windows小窗户，点击`设备管理器`，

   ![QQ_1759112121434](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/QQ_1759112121434.png)

![QQ_1759112235078](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/QQ_1759112235078.png)

我们看到，这个CH340的串口号是14，那么我们在`STC-ISP`里选择14端口号就可以了。

> 注意一下，串口只能由一个应用访问，不能多个应用同时访问。

### 3. 设置单片机的工作频率

![QQ_1759112353868](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/QQ_1759112353868.png)

选择12MHz即可。

### 4. 选择要烧录的二进制文件

点击打开程序文件，在弹出的目录中，选择keil5项目文件夹中，Objects文件夹中的项目名.hex文件。

![QQ_1759112401218](./%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE.assets/QQ_1759112401218.png)

### 5. 下载

   点击左下角的下载/编程，软件就会和MCU通信，这时候关闭MCU的开关，再打开，即可进行下载。下载需要一段时间，需要等一会。下载成功后会有提示。

   为了方便调试，可以打开`每次下载前都重新装载目标文件` `当目标文件变化时自动装载并发送下载命令`，这样当你编译完成后，点击单片机的开关即可完成下载，而不用再去`STC-ISP`点下载按钮。
